<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./../template.xhtml">

            <ui:define name="top">

            </ui:define>

            <ui:define name="content">
                <h1> #{product.currentProduct.name} </h1>
                <strong>Category</strong>
                #{product.currentProduct.category}
                <br></br>
                <strong>Description:</strong>
                #{product.currentProduct.description}
                <br></br>
                <strong>Current highest bid:</strong>
                <h:outputText value="#{product.currentProduct.currentHighestBid}" >
                                                         <f:convertNumber currencyCode="NOK" type="currency" />
                                                    </h:outputText>
      
                
                <h:form class="form-horizontal">

                    <div class="form-group">
                        <div class="col-md-1">
                            <h:outputLabel value="Bid price:"/>

                        </div>
                        <div class="col-md-2">
                            <h:inputText  class="form-control spinner" value="#{bid.bid.price}"/>

                        </div>
                        <div class="col-md-2">
                            <h:commandButton value="Start bidding" class="btn btn-success" action="#{bid.postBid()}" />

                        </div>
                        <div class="col-md-2">
                            Buy instantly for 
                            <h:outputText value="#{product.currentProduct.sellPrice}">
                         
                                                         <f:convertNumber currencyCode="NOK" type="currency" />
                            </h:outputText>
                                                    
                        </div>

                        <div class="col-md-2">
                            <h:commandButton value="Buy instantly" class="btn btn-success" action="#{bid.postInstantBuy()}" />

                        </div>
                    </div>

                </h:form>
                <table class="table-bordered">
                    <tr>
                        <td>  <img  src="#{request.contextPath}/resources/img/product.jpg" alt="" /></td>
                        <td height="400px"><strong>Bidding expires on :</strong> ${product.currentProduct.deadline.toGMTString()}
                            <p>
                                <strong> Start bidprice:</strong> 
                                <h:outputText value="#{product.currentProduct.startPrice}" >
                                                         <f:convertNumber currencyCode="NOK" type="currency" />
                                                    </h:outputText>
                              <br></br>
                               
                              <strong>Seller score</strong>
                              
                            </p>
                        </td>
                    </tr>
                </table>
                <h2>Current bids</h2>
                <table class="table table-bordered">
                    <tr>
                        <th>Date</th>
                        <th>Name</th>
                        <th>Price</th>
                    </tr>

                    <c:forEach var="item" items="#{product.currentProduct.bids}">
                        <tr>
                            <td><h:outputText value="#{item.moment}" >
                                    <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
                                </h:outputText></td>
                            <td>#{item.bidder.fullname}</td>
                            <td> <h:outputText value="${item.price}" >
                                                         <f:convertNumber currencyCode="NOK" type="currency" />
                                                    </h:outputText></td>
                        </tr>
                    </c:forEach>



                </table>    
                
                <h2>Ratings of #{product.currentProduct.seller.fullname}</h2>
                <table class="table table-bordered">
                    <tr>
                        <th>Date</th>
                        <th>Name</th>
                        <th>Score</th>
                         <th>Feedback</th>
                    </tr>

                    <c:forEach var="item" items="#{product.currentProduct.seller.ratings}">
                        <tr>
                            <td><h:outputText value="#{item.moment}" >
                                    <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
                                </h:outputText></td>
                            <td>#{item.giver.fullname}</td>
                            <td> <h:outputText value="${item.rating}" >
                                          
                                                    </h:outputText></td>
                            
                            <td>#{item.feedback}</td>
                        </tr>
                    </c:forEach>



                </table>    

            </ui:define>

            <ui:define name="bottom">

            </ui:define>

        </ui:composition>

    </body>
</html>
